@if (showLayout) {
  <div class="layout-container">
    <aside class="sidebar" [class.collapsed]="sidebarCollapsed">
      <div class="logo">
        @if (!sidebarCollapsed) {
          <span class="logo-text">El Rincón del Inversor</span>
        }
      </div>
      <nav class="menu">
        <a routerLink="/dashboard" routerLinkActive="active">
          <mat-icon>dashboard</mat-icon>
          @if (!sidebarCollapsed) { <span>Menú Principal</span> }
        </a>
        <a routerLink="/empresas" routerLinkActive="active">
          <mat-icon>business</mat-icon>
          @if (!sidebarCollapsed) { <span>Empresas</span> }
        </a>
        <a routerLink="/historico" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <mat-icon>query_stats</mat-icon>
          @if (!sidebarCollapsed) { <span>Histórico</span> }
        </a>
        <a routerLink="/watchlist" routerLinkActive="active">
          <mat-icon>star</mat-icon>
          @if (!sidebarCollapsed) { <span>Lista de Favoritos</span> }
        </a>
        <a routerLink="/alertas" routerLinkActive="active">
          <mat-icon>notifications</mat-icon>
          @if (!sidebarCollapsed) { <span>Alertas</span> }
        </a>
        <a routerLink="/macros" routerLinkActive="active">
          <mat-icon>bar_chart</mat-icon>
          @if (!sidebarCollapsed) { <span>Macros</span> }
        </a>
        <a routerLink="/calculadora" routerLinkActive="active">
          <mat-icon>calculate</mat-icon>
          @if (!sidebarCollapsed) { <span>Calculadora</span> }
        </a>
        <a routerLink="/cartera" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <mat-icon>account_balance_wallet</mat-icon>
          @if (!sidebarCollapsed) { <span>Cartera</span> }
        </a>
        <a routerLink="/cartera/operaciones" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
          <mat-icon>history</mat-icon>
          @if (!sidebarCollapsed) { <span>Operaciones</span> }
        </a>
        <a routerLink="/saldo" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" class="saldo-link">
          <mat-icon color="primary">savings</mat-icon>
          @if (!sidebarCollapsed) {
            <span>
              Saldo {{ user?.saldo | currency : 'EUR' : 'symbol' : '1.2-2' : 'es-ES' }}
            </span>
          }
        </a>
        @if (user?.role === 'admin') {
          <a routerLink="/admin" routerLinkActive="active">
            <mat-icon>admin_panel_settings</mat-icon>
            @if (!sidebarCollapsed) { <span>Admin</span> }
          </a>
        }
      </nav>
    </aside>

    <div class="main">
      <header class="navbar" [class.collapsed]="sidebarCollapsed">
        <button class="toggle-btn" (click)="sidebarCollapsed = !sidebarCollapsed">
          <mat-icon>{{ sidebarCollapsed ? 'menu_open' : 'menu' }}</mat-icon>
        </button>

        <span class="spacer"></span>

        @if (user) {
          @if (!sidebarCollapsed) {
            <div class="user-info">
              <mat-icon>account_circle</mat-icon>
              <span class="username">{{ user.name }}</span>
              <button mat-flat-button color="warn" (click)="logout()">Cerrar sesión</button>
            </div>
          }
        } @else {
          @if (!sidebarCollapsed) {
            <button mat-flat-button color="primary" routerLink="/login">Login</button>
            <button mat-flat-button color="accent" routerLink="/register">Registro</button>
          }
        }
      </header>

      <main class="content">
        <router-outlet></router-outlet>
      </main>
    </div>
  </div>
} @else {
  <router-outlet></router-outlet>
}
